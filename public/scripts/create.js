(()=>{"use strict";var t;const e=/^[a-z]+(-[a-z]+)*$/;function s(t){if(!e.test(t))throw new SyntaxError(`name "${t}" does not match ${e}`);return`/styles/custom-elements/${t}.css`}var i;!function(t){t[t.PENDING=0]="PENDING",t[t.INITIALIZED=1]="INITIALIZED",t[t.FAILED=2]="FAILED"}(i||(i={}));class n extends HTMLElement{constructor(){super(...arguments),this.initState=i.PENDING,this.initResolvers=new Set,this.initRejectors=new Set}static loadStylesheet(t){return this.loadedTagNames.has(t)?Promise.resolve():new Promise(((e,i)=>{const n=document.createElement("link");n.rel="stylesheet",n.addEventListener("load",(()=>e())),n.addEventListener("error",i),n.href=s(t),window.addEventListener("DOMContentLoaded",(()=>document.head.appendChild(n)))}))}onceInitialized(){const{promise:t,resolve:e,reject:s}=Promise.withResolvers();switch(this.initState){case i.PENDING:this.initResolvers.add(e),this.initRejectors.add(s);break;case i.INITIALIZED:e(this);break;case i.FAILED:s(this.initErr)}return t}connectedCallback(){(this.initElement()??Promise.resolve()).then((()=>{for(const t of this.initResolvers)t(this);this.initState=i.INITIALIZED})).catch((t=>{this.initErr=t;for(const t of this.initRejectors)t(this.initErr);this.initState=i.FAILED})).finally((()=>{this.initResolvers.clear(),this.initRejectors.clear()}))}initElement(){console.warn("initElement method is not overridden for "+this.constructor.name)}on(t,e){return this.addEventListener(t,(t=>e(t,this))),this}once(t){return new Promise((e=>{this.addEventListener(t,(t=>e([t,this])),{once:!0})}))}}t=n,n.loadedTagNames=new Set,(()=>{const e=customElements.define.bind(customElements);customElements.define=(i,n,o)=>{let r=n;for(;r;){if(r===t){t.loadStylesheet(i).then((()=>console.info(`Loaded stylesheet for "${i}"`))).catch((()=>console.warn(`Failed to load stylesheet for "${i}". Make sure to have a CSS stylesheet at ${s(i)}`))).finally((()=>t.loadedTagNames.add(i)));break}r=Object.getPrototypeOf(r)}return e(i,n,o)}})();const o=n;class r extends o{get isControlsVisible(){return this.hasAttribute("controls-visible")}set isControlsVisible(t){this.toggleAttribute("controls-visible",t)}constructor(){super(),this.transform={position:{x:0,y:0},size:{width:10,height:10},rotation:0}}initElement(){this.toggleAttribute("transformable",!0),this.refreshCSSVars();let t=!1,e={x:0,y:0};window.addEventListener("mousedown",(s=>{t=!0,e=r.Position.mult(r.getMouseOffset(s,this),r.Position.getScaleFactor(this,this.parentElement)),this.isControlsVisible=s.target===this})),window.addEventListener("mousemove",(s=>{this.isControlsVisible&&t&&(this.transform.position=r.Position.sub(r.getMouseOffset(s,this.parentElement),e),this.refreshCSSVars())})),window.addEventListener("mouseup",(()=>t=!1))}refreshCSSVars(){this.style.setProperty("--transform-position-x",this.transform.position.x+"%"),this.style.setProperty("--transform-position-y",this.transform.position.y+"%"),this.style.setProperty("--transform-size-width",this.transform.size.width+"%"),this.style.setProperty("--transform-size-height",this.transform.size.height+"%"),this.style.setProperty("--transform-rotation",this.transform.rotation+"deg")}static getMouseOffset(t,e){const s=e.getBoundingClientRect();return{x:(t.clientX-s.x)/s.width*100,y:(t.clientY-s.y)/s.height*100}}}o.loadStylesheet("transformable"),function(t){let e;!function(t){t.add=function(t,e){return{x:t.x+e.x,y:t.y+e.y}},t.sub=function(t,e){return{x:t.x-e.x,y:t.y-e.y}},t.mult=function(t,e){return{x:t.x*e.x,y:t.y*e.y}},t.getScaleFactor=function(t,e){const s=t.getBoundingClientRect(),i=e.getBoundingClientRect();return{x:s.width/i.width,y:s.height/i.height}}}(e=t.Position||(t.Position={}))}(r||(r={}));const a=r;customElements.define("transformable-image",class extends a{})})();